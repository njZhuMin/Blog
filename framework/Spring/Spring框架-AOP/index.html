<!DOCTYPE html><html class="theme-next mist use-motion" lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/blog/css/main.css?v=7.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=7.0.0"><link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=7.0.0"><link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=7.0.0"><link rel="mask-icon" href="/blog/images/logo.svg?v=7.0.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/blog/",scheme:"Mist",version:"7.0.0",sidebar:{position:"right",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"50SSEXL4H4",apiKey:"c70727fbe941c35bf934c017a5dab247",indexName:"hexo_index",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="Spring系列文章：https://zhum.in/blog/categories/frame/Spring/   项目代码：https://github.com/njZhuMin/SpringDemo   AOP面向切面编程AOP(Aspect Oriented programming)：面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。主要的功能是：日志记录，性"><meta name="keywords" content="spring,AOP"><meta property="og:type" content="article"><meta property="og:title" content="Spring框架-AOP"><meta property="og:url" content="https://zhum.in/blog/framework/Spring/Spring框架-AOP/index.html"><meta property="og:site_name" content="SilverLining&#39;s Blog"><meta property="og:description" content="Spring系列文章：https://zhum.in/blog/categories/frame/Spring/   项目代码：https://github.com/njZhuMin/SpringDemo   AOP面向切面编程AOP(Aspect Oriented programming)：面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。主要的功能是：日志记录，性"><meta property="og:locale" content="en"><meta property="og:updated_time" content="2019-02-21T09:36:58.904Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Spring框架-AOP"><meta name="twitter:description" content="Spring系列文章：https://zhum.in/blog/categories/frame/Spring/   项目代码：https://github.com/njZhuMin/SpringDemo   AOP面向切面编程AOP(Aspect Oriented programming)：面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。主要的功能是：日志记录，性"><link rel="canonical" href="https://zhum.in/blog/framework/Spring/Spring框架-AOP/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>Spring框架-AOP | SilverLining's Blog</title><script async src="//www.googletagmanager.com/gtag/js?id=UA-106643397-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-106643397-1")</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="en"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/blog/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">SilverLining's Blog</span><span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"> <button aria-label="Toggle navigation bar"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-commonweal"><a href="/blog/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>Commonweal 404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="algolia-popup popup search-popup"><div class="algolia-search"><div class="algolia-search-input-icon"><i class="fa fa-search"></i></div><div class="algolia-search-input" id="algolia-search-input"></div></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://zhum.in/blog/blog/framework/Spring/Spring框架-AOP/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="SilverLining"><meta itemprop="description" content=""><meta itemprop="image" content="/blog/images/avatar.png"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="SilverLining's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Spring框架-AOP</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2016-06-03 09:31:16" itemprop="dateCreated datePublished" datetime="2016-06-03T09:31:16+08:00">2016-06-03</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-02-21 17:36:58" itemprop="dateModified" datetime="2019-02-21T17:36:58+08:00">2019-02-21</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/framework/" itemprop="url" rel="index"><span itemprop="name">framework</span></a></span> , <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/blog/categories/framework/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span></span> <span id="/blog/framework/Spring/Spring框架-AOP/" class="leancloud_visitors" data-flag-title="Spring框架-AOP"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">Views:</span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>Spring系列文章：<br><a href="https://zhum.in/blog/categories/frame/Spring/">https://zhum.in/blog/categories/frame/Spring/</a></p></blockquote><blockquote><p>项目代码：<br><a href="https://github.com/njZhuMin/SpringDemo" target="_blank" rel="noopener">https://github.com/njZhuMin/SpringDemo</a></p></blockquote><hr><h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><h2 id="面向切面编程"><a href="#面向切面编程" class="headerlink" title="面向切面编程"></a>面向切面编程</h2><p>AOP(Aspect Oriented programming)：面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。<br>主要的功能是：日志记录，性能统计，安全控制，事务处理，异常处理等等。</p><h2 id="AOP实现方式"><a href="#AOP实现方式" class="headerlink" title="AOP实现方式"></a>AOP实现方式</h2><ol><li>预编译 - AspectJ</li><li>运行期动态代理（JDK动态代理、CGLib动态代理）<br>SpringAOP、JbossAOP</li></ol><blockquote><p>有接口的SpringAOP实现使用JDK动态代理作为AOP代理，这使得任何接口（或接口集）都可以被代理；<br>如果一个业务对象并没有实现一个接口，Spring AOP中也可以使用CGLIB代理。</p></blockquote><a id="more"></a><h2 id="AOP通知（Advice）类型"><a href="#AOP通知（Advice）类型" class="headerlink" title="AOP通知（Advice）类型"></a>AOP通知（Advice）类型</h2><ol><li><p>前置通知（before advice），在JointPoint前执行</p></li><li><p>返回后通知（after returning advice），在JointPoint后执行</p></li><li><p>抛出异常后通知（after throwing advice），在JointPoint抛出异常时执行</p></li><li><p>后通知：（after[finally] advice），在JointPoint调用完毕后执行</p></li><li><p>环绕通知：（around advice），在JointPoint前后执行</p></li></ol><h2 id="Spring框架中AOP"><a href="#Spring框架中AOP" class="headerlink" title="Spring框架中AOP"></a>Spring框架中AOP</h2><ul><li>用途</li></ul><ol><li>提供了声明式的企业服务，特别是EJB的替代服务的声明</li><li>允许用户定制自己的方面，以完成OOP与AOP的互补使用</li></ol><ul><li>实现</li></ul><ol><li>纯Java实现，无需特殊的编译过程，不需要控制类加载器层次</li><li>目前只支持方法执行连接点（通知Spring Bean的方法执行）</li><li>不是为了提供最完整的AOP实现，而是侧重于提供一种AOP实现和Spring IoC容器之间的整合，用于帮助解决企业应用中的常见问题</li><li>Spring AOP不会与AspectJ竞争，从而提供综合全面的AOP解决方案</li></ol><h2 id="Schema-based-AOP"><a href="#Schema-based-AOP" class="headerlink" title="Schema-based AOP"></a>Schema-based AOP</h2><p>Spring所以的切面和通知器都必须放在一个<code>&lt;aop:config&gt;</code>内（可以配置包含多个<code>&lt;aop:config&gt;</code>元素，每一个<code>&lt;aop:config&gt;</code>可以包含<code>pointcut</code>，<code>advisor</code>和<code>aspect</code>元素（必须按照这个顺序进行声明）。</p><ul><li>环绕通知（around advice）的方法第一个参数必须为<code>ProceedingJoinPoint</code>类型。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectBiz</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">biz</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"AspectBiz.biz()"</span>);</span><br><span class="line"><span class="comment">//        throw new RuntimeException();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyAspect before..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyAspect afterReturning..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyAspect afterThrowing..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyAspect after..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> </span>&#123;</span><br><span class="line">        Object object = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"MyAspect around 1..."</span>);</span><br><span class="line">            object = pjp.proceed();</span><br><span class="line">            System.out.println(<span class="string">"MyAspect around 2..."</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"com.sunnywr.aop.schema.advice.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"aspectBiz"</span> <span class="attr">class</span>=<span class="string">"com.sunnywr.aop.schema.advice.biz.AspectBiz"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"myAspectAOP"</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"myPointcut"</span> <span class="attr">expression</span>=</span></span><br><span class="line"><span class="tag">                    "<span class="attr">execution</span>(* <span class="attr">com.sunnywr.aop.schema.advice.biz.</span>*<span class="attr">Biz.</span>*(<span class="attr">..</span>))" /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterReturning"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"afterThrowing"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"after"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"around"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Advice-Parameters"><a href="#Advice-Parameters" class="headerlink" title="Advice Parameters"></a>Advice Parameters</h2><p>在Advice Parameters中指定具体某个方法（带参数）的配置方式，参数可以被对应的advice方法使用。以aroud为例：<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundInit"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* com.sunnywr.aop.schema.advice.biz.AspectBiz.init(String, int))	and args(bizName, times)"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p></p><ul><li>AspectBiz.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(String bizName, <span class="keyword">int</span> times)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"AspectBiz init: "</span> + bizName + <span class="string">", "</span> + times);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>MyAspect.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">aroundInit</span><span class="params">(ProceedingJoinPoint pjp, String bizName, <span class="keyword">int</span> times)</span> </span>&#123;</span><br><span class="line">    System.out.println(bizName + <span class="string">", "</span> + times);</span><br><span class="line">    Object object = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"MyAspect aroundInit 1..."</span>);</span><br><span class="line">        object = pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">"MyAspect aroundInit 2..."</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">        throwable.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Test方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AspectBiz biz = <span class="keyword">super</span>.getBean(<span class="string">"aspectBiz"</span>);</span><br><span class="line">    biz.init(<span class="string">"myService"</span>, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Introductions"><a href="#Introductions" class="headerlink" title="Introductions"></a>Introductions</h2><ul><li><p>简介通知（Introductions）允许一个切面声明一个实现指定接口的通知对象，并且提供了一个接口实现类来代表这些对象。</p></li><li><p>Introductions由<code>&lt;aop:aspect&gt;</code>中的<code>&lt;aop:declare-parents&gt;</code>元素声明该元素用于声明所匹配的类型拥有一个新的parent。</p></li><li><p>对于<code>&lt;declare-parents&gt;</code>的作用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:declare-parents</span> <span class="attr">types-matching</span>=<span class="string">"com.sunnywr.aop.schema.advice.biz.*(+)"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">implement-interface</span>=<span class="string">"com.sunnywr.aop.schema.advice.Fit"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">default-impl</span>=<span class="string">"com.sunnywr.aop.schema.advice.FitImpl"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>在这里，declare-parents 为types-matching中的类（用proxy表示）指定了一个父类，然后又在指定了此父类为接口interface，并指出此父类的一个默认实现类impl。</p><p> 这个运用的属于代理模式中的静态代理，本质上就是通过proxy代理了impl，实现并可以加强imple中的功能。假如说impl中只有一个方法<code>method()</code>，那么proxy就可以代理<code>method()</code>并为其添加附加功能、设定访问权限等等。</p><blockquote><p>schema-defined aspects只支持singleton mode</p></blockquote><h2 id="Advisors"><a href="#Advisors" class="headerlink" title="Advisors"></a>Advisors</h2><ul><li><p>advisor就像一个小的自包含的方面，只有一个advice</p></li><li><p>切面自身通过一个bean表示，并且必须实现某个advice接口，同时，advisor也可以很好的利用AspectJ的切入表达式</p></li><li><p>Spring通过配置文件中<code>&lt;aop:advisor&gt;</code>元素支持advisor实际使用中，大多数情况下它会和<code>transactional advice</code>配合使用</p></li><li><p>为了定义一个advisor的优先级以便让advice可以有序，可以使用order属性来定义advisor的顺序</p></li></ul><h1 id="Spring-AOP-API"><a href="#Spring-AOP-API" class="headerlink" title="Spring AOP API"></a>Spring AOP API</h1><h2 id="Pointcut"><a href="#Pointcut" class="headerlink" title="Pointcut"></a>Pointcut</h2><p>实现之一：NameMatchMethodPointcut（根据方法名字匹配）<br>成员变量：mappedNames，匹配的方法名集合：<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"pointcutBean"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.NameMatchMethodPointcut"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mappedNames"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>sa*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h2 id="Before-Advice"><a href="#Before-Advice" class="headerlink" title="Before Advice"></a>Before Advice</h2><p>只在进入方法之前被调用，不需要<code>MethodInvocation</code>对象。前置通知可以在连接点之前插入自定义行为，但不能改变返回值。</p><p>Before Advice需要实现<code>MethodBeforeAdvice</code>接口：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeforeAdvice</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyBeforeAdvice: "</span> + method.getName()</span><br><span class="line">                + <span class="string">", target: "</span> + target.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="Throws-Advice"><a href="#Throws-Advice" class="headerlink" title="Throws Advice"></a>Throws Advice</h2><ul><li><p>如果连接点抛出异常，throws advice在连接点返回后被调用</p></li><li><p>如果throws-advice的方法抛出异常，将覆盖原有异常</p></li><li><p>接口<code>org.springframework.aop.ThrowsAdvice</code>不包含任何方法，仅仅是一个声明，但需要实现类实现类似以下方法：<br><code>void afterThrowing([Method, args, target], ThrowableSubclass);</code></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThrowsAdvice</span> <span class="keyword">implements</span> <span class="title">ThrowsAdvice</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(Exception ex)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyThrowsAdvice afterThrowing 1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(Method method, Object[] args, Object target, Exception ex)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyThrowsAdvice afterThrowing 2: "</span></span><br><span class="line">            + method.getName() + <span class="string">" "</span> + target.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="After-Returning-Advice"><a href="#After-Returning-Advice" class="headerlink" title="After Returning Advice"></a>After Returning Advice</h2><ul><li><p>后置通知必须实现<code>org.springframework.aop.AfterReturningAdvice</code>接口</p></li><li><p>可以访问返回值（但不能修改）、被调用的方法、方法的参数和目标</p></li><li><p>如果抛出异常，将会抛出拦截器链，替代返回值</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAfterReturningAdvice</span> <span class="keyword">implements</span> <span class="title">AfterReturningAdvice</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyAfterReturningAdvice afterReturning: "</span></span><br><span class="line">                + method.getName() + <span class="string">" "</span> + target.getClass().getName() + <span class="string">" "</span> + returnValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Interception-Around-Advice"><a href="#Interception-Around-Advice" class="headerlink" title="Interception Around Advice"></a>Interception Around Advice</h2><p>Spring的切入点模型使得切入点可以独立与Advice重用，以针对不同的Advice可以使用相同的切入点。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMethodInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyMethodInterceptor 1: "</span> + invocation.getMethod().getName()</span><br><span class="line">            + <span class="string">" "</span> + invocation.getStaticPart().getClass().getName());</span><br><span class="line">        Object obj = invocation.proceed();</span><br><span class="line">        System.out.println(<span class="string">"MyMethodInterceptor 2: "</span> + obj);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Introduction-Advice"><a href="#Introduction-Advice" class="headerlink" title="Introduction Advice"></a>Introduction Advice</h2><ul><li><p>Spring把引入通知作为一种特殊的拦截通知</p></li><li><p>需要<code>Introduction Advisor</code>和<code>Introduction Interceptor</code></p></li><li><p>仅适用于类，不能和任何切入点一起使用</p></li></ul><blockquote><ul><li>如果调用<code>lock</code>方法，希望所有<code>setter</code>方法抛出<code>LockedException</code>异常，使对象不可改变；</li></ul></blockquote><blockquote><ul><li>需要一个完成繁重任务的<code>IntroductionInterceptor</code>，这种情况下可以使用<code>org.springframework.aop.support.DelegatingIntroductionInterceptor;</code></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Lockable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockMixin</span> <span class="keyword">extends</span> <span class="title">DelegatingIntroductionInterceptor</span> <span class="keyword">implements</span> <span class="title">Lockable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">6943163819932660450L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> locked;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.locked = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.locked = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.locked;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isLocked() &amp;&amp; invocation.getMethod().getName().indexOf(<span class="string">"set"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.invoke(invocation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockMixinAdvisor</span> <span class="keyword">extends</span> <span class="title">DefaultIntroductionAdvisor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">171332350782163120L</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LockMixinAdvisor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> LockMixin(), Lockable.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Advisor-API"><a href="#Advisor-API" class="headerlink" title="Advisor API"></a>Advisor API</h2><ul><li><p>Advisor是仅包含一个切入点表达式关联的单个通知方面</p></li><li><p>除了introductions，advisor可以用于任何通知</p></li><li><p><code>org.springframework.aop.support.DefaultPointcutAdvisor</code>是最常用的advisor类，它可以与<code>MethodInterceptor</code>，<code>BeforeAdvice</code>或<code>ThrowsAdvice</code>一起使用</p></li><li><p>它可以混合在Spring同一个AOP代理的advisor和advice</p></li></ul><h2 id="ProxyFactoryBean"><a href="#ProxyFactoryBean" class="headerlink" title="ProxyFactoryBean"></a>ProxyFactoryBean</h2><p>创建String AOP代理的基本方法是使用<code>org.springframework.aop.framework.ProxyFactoryBean</code>，这可以完全控制切入点和通知（advice）以及他们的顺序。</p><p>例如，当我们向<code>ProxyFactoryBean</code>申请一个变量实例foo时，并不会获得一个<code>ProxyFactoryBean</code>实例，而是获得<code>ProxyFactoryBean</code>实现里的<code>getObject()</code>方法创建的对象。<code>getObject()</code>方法将创建一个AOP代理包装一个目标对象。</p><ul><li><p>使用<code></code>ProxyFactoryBean`或者其他IoC相关类来创建AOP代理的最重要的好处是通知和切入点也可以由IoC来管理</p></li><li><p>被代理类没有实现任何接口，使用CGLIB代理，否则使用JDK代理</p></li><li><p>通过设置<code>proxyTargetClass</code>为true，可以强制使用CGLIB</p></li><li><p>如果目标类实现了一个或者多个接口，那么创建代理的类型将依赖于<code>ProxyFactoryBean</code>的配置</p></li><li><p>如果<code>ProxyFactoryBean</code>的<code>proxyInterfaces</code>属性被设置位一个或多个全限定接口名，则会创建基于JDK代理。如果<code>ProxyFactoryBean</code>的<code>proxyInterfaces</code>属性没有被设置，但是目标类实现了一个或者多个接口，那么<code>ProxyFactoryBean</code>将自动检测这个目标类已经实现了至少一个接口，从而创建一个基于JDK的代理。</p></li></ul><h2 id="代理目标与内部匿名Bean"><a href="#代理目标与内部匿名Bean" class="headerlink" title="代理目标与内部匿名Bean"></a>代理目标与内部匿名Bean</h2><ul><li>代理目标</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bizLogicImplTarget"</span> <span class="attr">class</span>=<span class="string">"com.sunnywr.aop.api.BizLogicImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bizLogicImpl"</span>  <span class="attr">parent</span>=<span class="string">"baseProxyBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"bizLogicImplTarget"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>内部匿名Bean</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bizLogicImpl"</span>  <span class="attr">parent</span>=<span class="string">"baseProxyBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"bizLogicImplTarget"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>两种方式的区别</li></ul><p>在实现上两种方式没有区别，但是使用代理目标方式会暴露对象的bean类，可以在程序中直接获得该类的实例，可能会引起安全问题。因此推荐使用内部匿名Bean的方式来配置代理目标。</p><h2 id="Proxying-classes"><a href="#Proxying-classes" class="headerlink" title="Proxying classes"></a>Proxying classes</h2><p>在一些情况下，也可以强制使用CGLIB方式代理，即使目标类实现了接口。</p><p>CGLIB代理的工作原理是在运行时生成目标类的子类，Spring配置这个生成的子类委托方法调用到原来的目标。子类用来实现<code>Decorator</code>模式织入通知。</p><p>CGLIB的代理对用户是透明的，但是：</p><ul><li><p>final方法不能被通知，因为final方法不能被覆盖</p></li><li><p>不用手动引入CGLIB的依赖，在Spring 3.2后CGLIB被重新包装并包含在<code>Spring-core</code>包中</p></li></ul><h2 id="global-advisors"><a href="#global-advisors" class="headerlink" title="global advisors"></a>global advisors</h2><p>在配置文件中使用通配符，匹配所有拦截器并加入通知链：<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bizLogicImpl"</span>  <span class="attr">parent</span>=<span class="string">"baseProxyBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.sunnywr.aop.api.BizLogicImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;ref bean="bizLogicImplTarget" /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyInterfaces"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.sunnywr.aop.api.BizLogic<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>my*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><blockquote><p>通配符只会将拦截器加入通知链，也即实现了<code>MethodInterceptor</code>接口的类。</p></blockquote><h2 id="简化的proxy定义"><a href="#简化的proxy定义" class="headerlink" title="简化的proxy定义"></a>简化的proxy定义</h2><p>使用父子bean定义，以及内部bean定义，可能会带来更简洁的代理定义（抽象属性标记父bean，定义为抽象的，这样它就不能被实例化）<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"baseProxyBean"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">lazy-init</span>=<span class="string">"true"</span> <span class="attr">abstract</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h2 id="使用ProxyFactory"><a href="#使用ProxyFactory" class="headerlink" title="使用ProxyFactory"></a>使用ProxyFactory</h2><ul><li><p>使用Spring AOP而不必依赖于Spring IoC</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ProxyFactory factory = <span class="keyword">new</span> ProxyFactory(myBusinessInterfaceImpl);</span><br><span class="line">factory.addAdvice(myMethodInterceptor);</span><br><span class="line">factory.addAdvisor(myAdvisor);</span><br><span class="line">MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</span><br></pre></td></tr></table></figure></li><li><p>大多数情况下最佳实践是用IoC容器创建AOP代理</p></li><li><p>虽然可以使用硬编码方式实现，但是Spring推荐使用注解方式实现</p></li></ul><h2 id="使用auto-proxy"><a href="#使用auto-proxy" class="headerlink" title="使用auto-proxy"></a>使用auto-proxy</h2><ul><li><p>Spring也允许使用自动代理的bean定义，它可以自动代理选定的bean。这是建立在Spring的<code>bean post processor</code>功能基础上的（在加载bean的时候就可以修改）。</p></li><li><p>BeanNameAutoProxyCreator</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"beanNames"</span> <span class="attr">value</span>=<span class="string">"jdk*,onlyJdk"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>myInterceptor<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="DefaultAdvisorAutoProxyCreator"><a href="#DefaultAdvisorAutoProxyCreator" class="headerlink" title="DefaultAdvisorAutoProxyCreator"></a>DefaultAdvisorAutoProxyCreator</h2><p>当前IoC容器中自动应用，不用显示声明应用advisor的bean定义。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionInterceptor"</span> <span class="attr">ref</span>=<span class="string">"transactionInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customAdvisor"</span> <span class="attr">class</span>=<span class="string">"com.mycompany.MyAdvisor"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"businessObject1"</span> <span class="attr">class</span>=<span class="string">"com.mycompany.BusinessObject1"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Properties omitted --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"businessObject2"</span> <span class="attr">class</span>=<span class="string">"com.mycompany.BusinessObject2"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Spring对AspectJ的支持"><a href="#Spring对AspectJ的支持" class="headerlink" title="Spring对AspectJ的支持"></a>Spring对AspectJ的支持</h1><h2 id="AspectJ"><a href="#AspectJ" class="headerlink" title="AspectJ"></a>AspectJ</h2><ul><li><p><code>@AspectJ</code>的风格类似纯Java注解的普通Java类</p></li><li><p>Spring可以使用AspectJ来做切入点解析</p></li><li><p>AOP的运行时仍旧时纯Spring AOp，对AspectJ的编译器或者织入无依赖性</p></li></ul><h2 id="Spring中配置-AspectJ"><a href="#Spring中配置-AspectJ" class="headerlink" title="Spring中配置@AspectJ"></a>Spring中配置@AspectJ</h2><ul><li>对@AspectJ的支持可以使用xml或Java注解</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br></pre></td></tr></table></figure><ul><li>确保引入AspectJ的<code>aspectjweaver.jar</code>依赖</li></ul><h2 id="Aspect注解"><a href="#Aspect注解" class="headerlink" title="@Aspect注解"></a>@Aspect注解</h2><p>@AspectJ切面使用<code>@Aspect</code>注解配置，拥有<code>@Aspect</code>的任何bean将被Spring自动识别并应用。</p><p>用<code>@Aspect</code>注解的类可以有方法和字段，它们也可能包括切入点（pointcut）、通知（advice）和引入（introduction）声明。</p><blockquote><p>@Aspect注解是不能够通过类路径自动扫描得到的，所以需要配合使用@Component注释或者在bean中配置bean。一个类中的@Aspect注解标识他为一个切面，并且将自己从自动代理中排除。</p></blockquote><h2 id="pointcut"><a href="#pointcut" class="headerlink" title="pointcut"></a>pointcut</h2><ul><li><p>一个切入点通过一个普通的方法定义来提供，并且切入点表达式使用<code>@Pointcut</code>注解，方法返回类型必须为void</p></li><li><p>定义一个名为<code>anyOldTransfer</code>，这个切入点将匹配任何名为<code>transfer</code>的方法的执行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(* transfer(..))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyOldTransfer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="组合pointcut"><a href="#组合pointcut" class="headerlink" title="组合pointcut"></a>组合pointcut</h2><ul><li><p>切入点表达式可以通过<code>&amp;&amp;</code>、<code>||</code>和<code>!</code>进行组合，也可以通过名字引用切入点表达式</p></li><li><p>通过组合，可以建立更加复杂的切入点表达式</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(public * (..))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyPublicOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"within(com.example.someapp.trading..)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inTrading</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"anyPublicOperation() &amp;&amp; inTrading()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">tradingOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="定义良好的pointcuts"><a href="#定义良好的pointcuts" class="headerlink" title="定义良好的pointcuts"></a>定义良好的pointcuts</h2><ul><li><p>AspectJ是编译期的AOP</p></li><li><p>检查代码并匹配连接点与切入点的代价是昂贵的</p></li><li><p>一个好的切入点应该包括以下几点：</p><ul><li>选择特定类型的连接点，如execution、get、set、call、handler</li><li>确定连接点范围，如within、withincode</li><li>匹配上下文信息，如this、target、@annotation</li></ul></li></ul><h2 id="AfterReturning-Advice"><a href="#AfterReturning-Advice" class="headerlink" title="AfterReturning Advice"></a>AfterReturning Advice</h2><p>有时需要通知体内得到返回的实际值，可以使用<code>@AfterReturning</code>注解绑定具体的返回值。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterReturningExample</span> </span>&#123;</span><br><span class="line">	<span class="meta">@AfterReturning</span>(<span class="string">"com.example.myapp.SystemArchitecture.dataAccessOperation()"</span>, returning=<span class="string">"retVal"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">(Object retVal)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="AfterThrowing-Advice"><a href="#AfterThrowing-Advice" class="headerlink" title="AfterThrowing Advice"></a>AfterThrowing Advice</h2><p>有时需要通知体内得到返回的异常，可以使用<code>@AfterReturning</code>注解绑定抛出的异常。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterThrowingExample</span> </span>&#123;</span><br><span class="line">	<span class="meta">@AfterReturning</span>(<span class="string">"com.example.myapp.SystemArchitecture.dataAccessOperation()"</span>, returning=<span class="string">"ex"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRecoveryActions</span><span class="params">(DataAccessException ex)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="After-finally-Advice"><a href="#After-finally-Advice" class="headerlink" title="After(finally) Advice"></a>After(finally) Advice</h2><p>最终通知必须准备处理正常和异常两种返回情况，通常用于释放资源。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterFinallyExample</span> </span>&#123;</span><br><span class="line">	<span class="meta">@After</span>(<span class="string">"com.example.myapp.SystemArchitecture.dataAccessOperation()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doReleaseLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="Around-Advice"><a href="#Around-Advice" class="headerlink" title="Around Advice"></a>Around Advice</h2><ul><li><p>环绕通知使用<code>@Around</code>注解来声明，通知方法的第一个参数必须是<code>ProceedingJoinPoint</code>类型</p></li><li><p>在通知内部调用<code>ProceedingJoinPoint</code>的<code>proceed()</code>方法会导致执行真正的方法时传入一个Object[]对象，数组中的值将被作为参数传递给方法。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AroundExample</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Around</span>(<span class="string">"com.example.myapp.SystemArchitecture.businessService()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBasicProfilingk</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		<span class="comment">//start stopwatch</span></span><br><span class="line">		Object retVal = pjp.proceed();</span><br><span class="line">		<span class="comment">//stop stopwatch</span></span><br><span class="line">		<span class="keyword">return</span> retVal;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Advice传递参数"><a href="#Advice传递参数" class="headerlink" title="Advice传递参数"></a>Advice传递参数</h2><ol><li><p>直接传递具体的参数</p></li><li><p>通过注解的方式传递参数：@Before、@AfterReturning、@AfterThrowing、@After、@Round</p></li><li><p>Spring AOP可以处理泛型类的声明和使用方法的参数</p></li></ol><h2 id="Advice参数名称"><a href="#Advice参数名称" class="headerlink" title="Advice参数名称"></a>Advice参数名称</h2><ul><li><p>通知和切入点注解的<code>argNames</code>属性可以指定所注解方法的参数名</p></li><li><p>如果第一个参数是JoinPoint，ProceedingJoinPoint，JoinPoint.StaticPart，那么就可以忽视它</p></li></ul><h2 id="Introductions-1"><a href="#Introductions-1" class="headerlink" title="Introductions"></a>Introductions</h2><ul><li><p>允许一个切面声明一个通知对象实现指定接口，并且提供了一个接口实现类来代表这些对象</p></li><li><p>introduction使用<code>@DeclareParents</code>进行注解，这个注解用来定义匹配的类型拥有一个新的parent</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsageTracking</span> </span>&#123;</span><br><span class="line">	<span class="meta">@DeclareParents</span>(value=<span class="string">"com.example.myapp.service.*+"</span>, defaultImpl=DefaultUsageTracked.class)</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> UsageTracked mixin;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Before</span>(<span class="string">"com.example.myapp.SystemArchitecture.businessService() &amp;&amp; this(usageTracked)"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recordUsage</span><span class="params">(UsageTracked usageTracked)</span> </span>&#123;</span><br><span class="line">		usageTracked.incrementUseCount();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="切面实例化模型"><a href="#切面实例化模型" class="headerlink" title="切面实例化模型"></a>切面实例化模型</h1><ul><li><p><code>perthis</code>切面通过指定<code>@Aspect</code>注解perthis子句实现</p></li><li><p>每个独立的service对象执行时都会创建一个切面实例</p></li><li><p>service对象的每个方法在第一次执行的时候创建切面实例，切面在service对象失效的同时失效。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span>(<span class="string">"perthis(com.example.myapp.SystemArchitecture.businessService())"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> someState;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Before</span>(com.example.myapp.SystemArchitecture.businessService())</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recordServiceUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-tags"> <a href="/blog/tags/spring/" rel="tag"># spring</a> <a href="/blog/tags/AOP/" rel="tag"># AOP</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/blog/framework/Spring/Spring框架-IoC/" rel="next" title="Spring框架-IoC"><i class="fa fa-chevron-left"></i> Spring框架-IoC</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/blog/framework/Spring/Spring事务管理/" rel="prev" title="Spring事务管理">Spring事务管理<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8yNzgzNS80NDEx"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> Overview</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/blog/images/avatar.png" alt="SilverLining"><p class="site-author-name" itemprop="name">SilverLining</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/blog/archives"><span class="site-state-item-count">39</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/blog/categories/index.html"><span class="site-state-item-count">26</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">39</span> <span class="site-state-item-name">tags</span></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/njZhuMin" title="GitHub &rarr; https://github.com/njZhuMin" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:minmin3772@gmail.com" title="E-Mail &rarr; mailto:minmin3772@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://twitter.com/minmin3772" title="Twitter &rarr; https://twitter.com/minmin3772" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#AOP"><span class="nav-number">1.</span> <span class="nav-text">AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#面向切面编程"><span class="nav-number">1.1.</span> <span class="nav-text">面向切面编程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOP实现方式"><span class="nav-number">1.2.</span> <span class="nav-text">AOP实现方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOP通知（Advice）类型"><span class="nav-number">1.3.</span> <span class="nav-text">AOP通知（Advice）类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring框架中AOP"><span class="nav-number">1.4.</span> <span class="nav-text">Spring框架中AOP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Schema-based-AOP"><span class="nav-number">1.5.</span> <span class="nav-text">Schema-based AOP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advice-Parameters"><span class="nav-number">1.6.</span> <span class="nav-text">Advice Parameters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Introductions"><span class="nav-number">1.7.</span> <span class="nav-text">Introductions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advisors"><span class="nav-number">1.8.</span> <span class="nav-text">Advisors</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-AOP-API"><span class="nav-number">2.</span> <span class="nav-text">Spring AOP API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Pointcut"><span class="nav-number">2.1.</span> <span class="nav-text">Pointcut</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Before-Advice"><span class="nav-number">2.2.</span> <span class="nav-text">Before Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Throws-Advice"><span class="nav-number">2.3.</span> <span class="nav-text">Throws Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#After-Returning-Advice"><span class="nav-number">2.4.</span> <span class="nav-text">After Returning Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interception-Around-Advice"><span class="nav-number">2.5.</span> <span class="nav-text">Interception Around Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction-Advice"><span class="nav-number">2.6.</span> <span class="nav-text">Introduction Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advisor-API"><span class="nav-number">2.7.</span> <span class="nav-text">Advisor API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ProxyFactoryBean"><span class="nav-number">2.8.</span> <span class="nav-text">ProxyFactoryBean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代理目标与内部匿名Bean"><span class="nav-number">2.9.</span> <span class="nav-text">代理目标与内部匿名Bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Proxying-classes"><span class="nav-number">2.10.</span> <span class="nav-text">Proxying classes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#global-advisors"><span class="nav-number">2.11.</span> <span class="nav-text">global advisors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简化的proxy定义"><span class="nav-number">2.12.</span> <span class="nav-text">简化的proxy定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用ProxyFactory"><span class="nav-number">2.13.</span> <span class="nav-text">使用ProxyFactory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用auto-proxy"><span class="nav-number">2.14.</span> <span class="nav-text">使用auto-proxy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DefaultAdvisorAutoProxyCreator"><span class="nav-number">2.15.</span> <span class="nav-text">DefaultAdvisorAutoProxyCreator</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring对AspectJ的支持"><span class="nav-number">3.</span> <span class="nav-text">Spring对AspectJ的支持</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AspectJ"><span class="nav-number">3.1.</span> <span class="nav-text">AspectJ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring中配置-AspectJ"><span class="nav-number">3.2.</span> <span class="nav-text">Spring中配置@AspectJ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Aspect注解"><span class="nav-number">3.3.</span> <span class="nav-text">@Aspect注解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pointcut"><span class="nav-number">3.4.</span> <span class="nav-text">pointcut</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组合pointcut"><span class="nav-number">3.5.</span> <span class="nav-text">组合pointcut</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定义良好的pointcuts"><span class="nav-number">3.6.</span> <span class="nav-text">定义良好的pointcuts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AfterReturning-Advice"><span class="nav-number">3.7.</span> <span class="nav-text">AfterReturning Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AfterThrowing-Advice"><span class="nav-number">3.8.</span> <span class="nav-text">AfterThrowing Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#After-finally-Advice"><span class="nav-number">3.9.</span> <span class="nav-text">After(finally) Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Around-Advice"><span class="nav-number">3.10.</span> <span class="nav-text">Around Advice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advice传递参数"><span class="nav-number">3.11.</span> <span class="nav-text">Advice传递参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advice参数名称"><span class="nav-number">3.12.</span> <span class="nav-text">Advice参数名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Introductions-1"><span class="nav-number">3.13.</span> <span class="nav-text">Introductions</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#切面实例化模型"><span class="nav-number">4.</span> <span class="nav-text">切面实例化模型</span></a></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">SilverLining</span></div><div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div> <span class="post-meta-divider">|</span><div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.0</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/blog/lib/jquery/index.js?v=2.1.3"></script><script src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/blog/js/src/utils.js?v=7.0.0"></script><script src="/blog/js/src/motion.js?v=7.0.0"></script><script src="/blog/js/src/schemes/muse.js?v=7.0.0"></script><script src="/blog/js/src/scrollspy.js?v=7.0.0"></script><script src="/blog/js/src/post-details.js?v=7.0.0"></script><script src="/blog/js/src/bootstrap.js?v=7.0.0"></script><script>window.livereOptions={refer:"framework/Spring/Spring框架-AOP/"},function(e,r){var t,n=e.getElementsByTagName(r)[0];"function"!=typeof LivereTower&&((t=e.createElement(r)).src="https://cdn-city.livere.com/js/embed.dist.js",t.async=!0,n.parentNode.insertBefore(t,n))}(document,"script")</script><link rel="stylesheet" href="/blog/lib/algolia-instant-search/instantsearch.min.css"><script src="/blog/lib/algolia-instant-search/instantsearch.min.js"></script><script src="/blog/js/src/algolia-search.js?v=7.0.0"></script><script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .done(function() {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.time + 1);
              })
            
              .fail(function ({ responseJSON }) {
                console.log(`Failed to save Visitor num, with error message: ${responseJSON.error}`);
              })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! More info at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log(`LeanCloud Counter Error: ${responseJSON.code} ${responseJSON.error}`);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'dE60AuNRvV8O14Cit2Qjogcu-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'dE60AuNRvV8O14Cit2Qjogcu-gzGzoHsz',
                'X-LC-Key': 'hCtWM3bYoy5hErcguwjeJjOU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script></body></html>